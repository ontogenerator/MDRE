---
title: "Multi-dimensional reward evaluation in mice"
header-includes:
   - \usepackage{lineno}
   - \linenumbers
   # - \usepackage{float} \floatplacement{figure}{H}
   - \newcommand{\beginsupplement}{\setcounter{table}{0}  \renewcommand{\thetable}{A\arabic{table}} \setcounter{figure}{0} \renewcommand{\thefigure}{A\arabic{figure}}}
output:   
  bookdown::pdf_document2:
    number_sections: no
    toc: no
bibliography: MDRE.bib
---
Vladislav Nachev^1,\*,&#8224;,\S^, Marion Rivalan^1,&#8224;,\S^, York Winter^1,\S^

^1^ Humboldt University, Berlin, Germany

**^\*^For correspondence:** vladislav.nachev\@charite.de  
^&#8224;^These authors contributed equally to this work

**Present Address:** ^\S^Dept. of Biology, Humboldt University, Philippstr. 13, 10099 Berlin, Germany

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

# Abstract

Please provide an abstract of no more than 150 words. Your abstract should explain the main contributions of your article, and should not contain any material that is not included in the main text. 

# Introduction

[@levy_root_2012]
[@kacelnik_risky_1998]
[@rosenstrom_scalar_2016]
[@rivalan_principles_2017]
The partial preference observed in choice experiments can be explained by profitability matching [@kacelnik_central_1984], which states that animals proportionally allocate their effort depending on the relative pay-off of the options. 

# Results

```{r, include = FALSE}
library(tidyverse)
library(gridExtra)
library(grid)
library(lubridate)
library(lme4)
library(coin)
library(kableExtra)
library(Hmisc)
library(broom.mixed)

miceChoices <- read.csv2(file = "data/ChoicesOutput.csv", header = TRUE, dec = ".", sep = ";",
                            na.strings = "NA") %>%
  mutate(vol = if_else(cohort == 2, vol * 4.8, vol))

miceChoices <- miceChoices %>%
  group_by(IdLabel, day) %>%
  filter(hour(DateTime) < 9 | hour(DateTime) > 15) %>% # due to older program version the initial visits
  # before the starting could not be flagged and therefore could not be removed by CSVreader.R
  # therefore they need to be removed here
  mutate(count = 1:n(), revcount = n():1) %>%
  group_by(rel,IdLabel,day) %>%
  mutate(relcount = 1:n()) %>%
  ungroup()

summaries <- miceChoices %>%
  group_by(cond, IdLabel, experiment, cohort, rint) %>%
  # take all visits after the first 150 visits at the relevant dispensers:
  filter(relcount > 150) %>%
  # in the following lines is an alternative cut-off point, which leads to very similar results
  # take the last 100 visits at any of the dispensers:
  # filter(revcount < 101) %>%
  summarise(performance = mean(prof, na.rm = TRUE), sampling = 1 - mean(rel),
            Ntot = n(), Nrel = sum(rel),successes_perf = sum(prof, na.rm = T),
            successes_sampl =  Ntot - Nrel) %>%
  ungroup() %>%
  mutate(cohort = factor(cohort))

exp3_tab <- miceChoices %>%
  filter(experiment == 3, !str_detect(cond,"[r]")) %>%
  group_by(cohort, cond) %>%
  summarise(vol = max(volm), prob = max(prob)) %>%
  group_by(cohort) %>%
  mutate(vol_prop = vol/max(vol),
         maxvol = max(vol),
         prob_prop = prob/max(prob),
         maxprob = max(prob),
         dim = str_sub(cond, 1, 1),
         bg_level = ifelse(dim == "P", vol_prop, prob_prop)) %>%
  ungroup() %>%
  mutate(cohort = factor(cohort)) %>%
  droplevels()

bg_vols <- exp3_tab %>%
  filter(dim == "P", cohort == 1) %>%
  select(bg_level, vol) %>%
  round(3)

bg_lev_vol <- paste(bg_vols$bg_level, collapse = ", ")
bg_vol <- paste(bg_vols$vol, collapse = ", ")

exp1 <- summaries %>% filter(!str_detect(cond, "[r]"), experiment == 1)
BVP1 <- exp1 %>%
  filter(cond == "BVP1")
exp2 <- summaries %>% filter(!str_detect(cond, "[r]"), experiment == 2) %>%
  bind_rows(BVP1)
exp3 <- summaries %>% filter(!str_detect(cond, "[r]"), experiment == 3) %>%
  inner_join(exp3_tab) %>%
  droplevels()
exp4 <- summaries %>% filter(!str_detect(cond, "[r]"), experiment == 4)

sesoi <- 0.1 # smallest effect size of interest
```

In order to test how (contradicting) information from two different dimensions is integrated and weighed, we performed a series of choice experiments (1-4, in chronological order) with mice in automated group cages [@rivalan_principles_2017]. The cages were outfitted with four computer-controlled liquid dispensers that delivered drinking water as a reward. During each of the 18h-long drinking sessions each mouse had access to all dispensers, but received rewards at only two of them. The two rewarding dispensers differed on one or both reward dimensions, probability and volume [@rivalan_principles_2017]. An overview of the differences between choice options in the different experimental conditions is given in Table \@ref(tab:conds). All experiments were conducted with three different cohorts of eight mice each. Cohort 2 was housed in a different automated group cage than cohorts 1 and 3 (See Animals, Materials, and Methods for differences between cages).

## Experiment 1  
In the baseline conditions rewards only differed on one dimension (the relevant dimension), but not on the other dimension (the background dimension). For example, in the BVP1 condition (read as baseline for volume at probability 1), both options had the same probability of 0.2, but one option had a volume of 4 $\mu$L and the other, a volume of 20 $\mu$L (Table \@ref(tab:conds)). Based on previous experiments [@rivalan_principles_2017], we expected a baseline difference between 4 $\mu$L and 20 $\mu$L volumes to result in a similar discrimination performance (relative preference for the superior option) compared to a baseline difference between probabilities 0.2 and 0.5. In the C (congruent) condition one option was superior to the other on both dimensions. Finally, in the I (incongruent) condition each of the two options was superior to the other on one of the two reward dimensions. Since the differences on both dimensions were chosen to be comparable, we expected the mean discrimination performance in the incongruent condition to be at chance level (0.5).  
In experiment 1 and in all subsequent experiments, each mouse had its own individual sequence of conditions, but each condition was followed by a reversal in the next drinking session, with a spatial inversion of the two rewarding dispensers. In order to investigate how the two reward dimensions contributed towards choice, we looked at the contrasts between the baselines (when only one dimension was relevant) to the conditions when the two dimensions were congruent or incongruent to each other. We used equivalence tests [@lakens_equivalence_2017] with an *a priori* smallest effect size of interest (sesoi) of `r sesoi`, i.e. we only considered absolute differences of at least `r sesoi` percentage points to be of biological relevance. Smaller differences, regardless of their statistical significance using other tests, were considered to be trivial.

```{r conds}
conds_tab <- miceChoices %>%
  ungroup() %>%
  filter(!str_detect(cond,"[r]"), cohort != 2, between(vol, 1, 20),
         experiment < 4, prob > 0) %>%
  select(experiment, cond, vol, prob) %>%
  distinct() %>%
  arrange(experiment, cond, vol, prob)

conds_tab <- conds_tab %>%
  mutate(odd = row_number(cond) %% 2, ret = vol*prob, vol2 = lead(vol), prob2 = lead(prob), ret2 = vol2*prob2, relret = ret/ret2) %>%
  filter(odd == 1) %>%
  select(-odd)

conds_tab %>%
  mutate(cond =
           if_else(cond == "BVP1", paste0(cond, kableExtra::footnote_marker_alphabet(4)),
                   as.character(cond))) %>%
  knitr::kable(booktabs = TRUE,
               caption = "Overview of the experimental conditions in all four experiments.",
               col.names = c(paste0("experiment", kableExtra::footnote_marker_alphabet(1)),
                             "condition",
                             paste0("volume", kableExtra::footnote_marker_alphabet(2)),
                             "probability",
                             paste0("return", kableExtra::footnote_marker_alphabet(3)),
                             paste0("volume", kableExtra::footnote_marker_alphabet(2)),
                             "probability",
                             paste0("return", kableExtra::footnote_marker_alphabet(3)),
                             "relative return"),
               escape = F) %>%
  kableExtra::kable_styling(latex_options = c("striped", "hold_position"),
                full_width = F) %>%
  kableExtra::add_header_above(c(" " = 2, "option A" = 3, "option B" = 3, "A/B" = 1)) %>%
  kableExtra::footnote(alphabet =
                         c("conditions in experiment 1 and 4 were identical; only conditions for experiment 1 are shown here for brevity; ",
                           "the volumes (in microliters) shown are for cohorts 1 and 3. In cohort 2 the volumes were 4.7 instead of 4, 9.4 instead of 10, 14.0 instead of 15, and 20.3 instead of 20 microliters; ",
                           "return rate (expected value); ",
                           "condition BVP1 in experiment 1 was not repeated in experiment 2, but instead the results from experiment 1 were reused in further analyses"),
                       threeparttable = T)
```
  
(ref:labresoverview) **Overview of discrimination performance for all mice in all experiments.** Experiments 1 through 4 are shown in different panels (1-4). Each symbol is the mean discrimination performance of an individual mouse over two presentations of the same condition (original and reversal). The experimental conditions are described in detail in Table \@ref(tab:conds). The discrimination performance gives the relative visitation rate of the more profitable option, or, in the incongruent condition, the option with the higher volume. Dashed line gives the chance level of 0.5. Data are shown in different colors for three different cohorts of eight mice each (total *N* = 24). Data from the same individuals are connected with lines. Cohort 2 (green symbols and lines) was tested in a different cage set-up than cohorts 1 and 2 (see Animals, Materials, and Methods for details). 

```{r resoverview, fig.cap="(ref:labresoverview)"}
ggexp12_4 <- summaries %>%
  filter(!str_detect(cond, "[r]"), experiment != 3) %>%
  ggplot() +
  geom_point(aes(cond, performance, color = cohort, group = IdLabel)) +
  geom_line(aes(cond, performance, color = cohort, group = IdLabel)) +
  facet_grid(experiment ~ .) + xlab("condition") + ylab("discrimination performance") +
  theme_bw() + scale_color_viridis_d() + guides(color = FALSE) +
  theme(strip.text.y = element_text(angle = 0)) +
  geom_hline(yintercept = 0.5, linetype = 2)
  # geom_hline(yintercept = 0.5 + sesoi, linetype = 2) +
  # geom_hline(yintercept = 0.5 - sesoi, linetype = 2) +
  # stat_summary(aes(cond, performance), fun.data = mean_cl_boot,
  #              fun.args = list(conf.int = 1 - 2*(alpha_2)),
  #              color = "darkblue", size = .5)

ggexp3 <- exp3 %>%
  ggplot() +
  geom_point(aes(cond, performance, color = cohort, group = IdLabel)) +
  geom_line(aes(cond, performance, color = cohort, group = IdLabel)) +
  facet_grid(experiment ~ .) + xlab("condition") +
  scale_y_continuous(name = "", breaks = seq(0, 1, 0.25)) +
  theme_bw() + scale_color_viridis_d() + theme(legend.position = "bottom") +
  theme(strip.text.y = element_text(angle = 0)) +
  geom_hline(yintercept = 0.5, linetype = 2)
  # geom_hline(yintercept = 0.5 + sesoi, linetype = 2) +
  # geom_hline(yintercept = 0.5 - sesoi, linetype = 2) +
  # stat_summary(aes(cond, performance), fun.data = mean_cl_boot,
  #              fun.args = list(conf.int = 1 - 2*(alpha_2)),
  #              color = "darkblue", size = .5)

get_legend <- function(a.gplot){ 
  tmp <- ggplot_gtable(ggplot_build(a.gplot)) 
  leg <- which(map(tmp$grobs, "name") == "guide-box") 
  legend <- tmp$grobs[[leg]] 
  return(legend)} 

leg <- get_legend(ggexp3)

lay <- rbind(c(1, 3),
             c(1, 2),
             c(1, NA))

grid.arrange(ggexp12_4, ggexp3 + guides(color = FALSE), leg, layout_matrix = lay,
             heights = c(1, 1.3, 1))
```

(ref:labresexp1) **Difference between discrimination performance in the baseline conditions and in the congruent and incongruent conditions in experiment 1**. Symbols show the individual differences in discrimination performance for the given conditions of each individual mouse (*N* = 24). Mice from different cohorts are shown in different colors. Large blue symbols give the means and the blue vertical lines the 90%-confidence intervals from bootstraps, corrected for multiple comparisons. When the confidence intervals lie completely within the smallest effect size of interest (sesoi) interval bounded by the dashed lines, there is statistical support for equivalence [@lakens_equivalence_2017]. When the confidence intervals do not cross the zero line, there is statistical support for difference. If the confidence intervals cross the zero line, but are not completely bounded by the sesoi, the results are inconclusive. The discrimination performances in the baseline conditions were calculated from the mean values from the two different baseline conditions for each reward dimension (volume and probability), i.e. BP was the mean of BPV1 and BPV2, and BV was the mean of BVP1 and BVP2 (Table \@ref(tab:conds)). The discrimination performance in the incongruent condition was calculated as the relative preference for the higher probability dispenser when contrasted with the probability baseline (I - BP) and for the higher volume dispenser when contrasted with the volume baseline (I - BV).     

```{r exp1, fig.cap="(ref:labresexp1)"}
exp1_simpl <- exp1 %>%
  ungroup() %>%
  mutate(cond = as.factor(ifelse(str_length(cond) == 4, str_sub(cond, 1, 2),
                                 as.character(cond)))) %>%
  group_by(cond, IdLabel, cohort) %>%
  summarise(performance = mean(performance))

exp1_diff <- exp1_simpl %>%
  spread(cond, performance) %>%
  mutate("BP - BV" = BP - BV, "C - BP" = C - BP, "C - BV" = C - BV,
         "I - BP" = 1 - I - BP, "I - BV" = I - BV) %>%
  select(-BV, -BP, -C, -I) %>%
  gather(cond, difference, -cohort, -IdLabel) %>%
  mutate(rel_dim = str_sub(cond, -1))

n_compare <- exp1_diff %>%
  ungroup() %>%
  filter(cond != "BP - BV") %>%
  pull(cond) %>%
  unique() %>%
  length()

set.seed(42)
mean_inc1 <- exp1 %>%
  filter(cond == "I") %>%
  pull(performance) %>%
  mean_cl_boot() %>%
  mutate_all(round, 3)


mean_ibp <- exp1_diff %>%
  filter(cond == "I - BP") %>%
  pull(difference) %>%
  mean_cl_boot() %>%
  mutate_all(round, 3)

mean_ibv <- exp1_diff %>%
  filter(cond == "I - BV") %>%
  pull(difference) %>%
  mean_cl_boot() %>%
  mutate_all(round, 3)

alpha_1 <- 0.05
alpha_2 <- 0.05 / (n_compare - 1) # alpha corrected for multiple comparisons

exp1_diff %>%
  filter(cond != "BP - BV") %>%
  ggplot(aes(cond, difference)) +
  geom_hline(yintercept = sesoi, linetype = 2) +
  geom_hline(yintercept = -sesoi, linetype = 2) +
  stat_summary(aes(cond, difference), fun.data = mean_cl_boot,
               fun.args = list(conf.int = 1 - 2*(alpha_2)),
               color = "darkblue", size = 1) +
  theme_bw() + geom_jitter(aes(color = cohort), alpha = 0.7, width = 0.1) +
  xlab("") + scale_color_viridis_d()

```

  
Compared to the baselines, mice showed an increase in discrimination performance in the congruent condition and a decrease in performance in the incongruent condition (Fig. \@ref(fig:exp1)). Contrary to our expectations, the trade-off between volume and probability did not abolish preference in the incongruent condition (Fig. \@ref(fig:resoverview)), with a discrimination performance significantly higher than the chance level of 0.5 (lower 95%CI < mean < upper 95%CI, `r paste(mean_inc1$ymin, mean_inc1$y, mean_inc1$ymax, sep = " < ")`). Thus, the volume dimension exerted a stronger influence on choice, at least in absolute terms.  
 
## Experiment 2
In previous experiments [@rivalan_principles_2017], we had shown that the relative stimulus intensity, i.e. the absolute difference between two options divided by their mean, was a good predictor of discrimination performance for both volume and probability differences. Another finding from these experiments was that, at least initially, mice responded less strongly to  differences in volume than to differences in probability, despite equivalence in return rates [@rivalan_principles_2017]. We tried to correct for this in experiment 1 by selecting options with a higher relative intensity for volume (4 $\mu$L vs. 20 $\mu$L, rel.int. = 1.33) than for probability (0.2 vs. 0.5, rel.int. = 0.857). In order to test whether we had over-corrected for decreased sensitivity to volume in experiment 1, we performed a slightly modified version, experiment 2, which was the same, but with probability of 1 instead of 0.5 in every choice option from experiment 1 (Table \@ref(tab:conds)). Thus, with the two choice options having the same relative intensities (rel.int. = 1.33) and being equivalent in return rates, we expected the discrimination performance in the incongruent condition to be at chance level if both dimensions were equally weighed and equally perceived. On the other hand, if mice were less sensitive for volume than for probability differences as in our previous experiments, then the discrimination performance in the incongruent condition should be skewed towards probability (< 0.5).  

(ref:labresexp2) **Difference between discrimination performance in the baseline conditions and in the congruent and incongruent conditions in experiment 2**. Same notation as in Fig. \@ref(fig:exp1). The discrimination performances in the baseline conditions were calculated from the mean values from the two different baseline conditions for each reward dimension (volume and probability), i.e. BP was the mean of BPV1 and BPV2, and BV was the mean of BVP1 and BVP2, where the values for condition BVP1 were taken from experiment 1 (Table \@ref(tab:conds)). The discrimination performance in the incongruent condition was calculated as the relative preference for the higher probability dispenser when contrasted with the probability baseline (I - BP) and for the higher volume dispenser when contrasted with the volume baseline (I - BV).

```{r exp2, fig.cap="(ref:labresexp2)"}
exp2_simpl <- exp2 %>%
  ungroup() %>%
  mutate(cond = as.factor(ifelse(str_length(cond) == 4, str_sub(cond, 1, 2),
                                 as.character(cond)))) %>%
  group_by(cond, IdLabel, cohort) %>%
  summarise(performance = mean(performance))

exp2_diff <- exp2_simpl %>%
  spread(cond, performance) %>%
  mutate("BP - BV" = BP - BV, "C - BP" = C - BP, "C - BV" = C - BV,
         "I - BP" = 1 - I - BP, "I - BV" = I - BV) %>%
  select(-BV, -BP, -C, -I) %>%
  gather(cond, difference, -cohort, -IdLabel)

set.seed(42)
mean_inc2 <- exp2 %>%
  filter(cond == "I") %>%
  pull(performance) %>%
  mean_cl_boot() %>%
  mutate_all(round, 3)

exp2_diff %>%
  filter(cond != "BP - BV") %>%
  ggplot(aes(cond, difference)) +
  geom_hline(yintercept = sesoi, linetype = 2) + geom_hline(yintercept = -sesoi, linetype = 2) +
  stat_summary(aes(cond, difference), fun.data = mean_cl_boot,
               fun.args = list(conf.int = 1 - 2*(alpha_2)),
               color = "darkblue", size = 1) +
  theme_bw() + geom_jitter(aes(color = cohort), alpha = 0.7, width = 0.1) +
  xlab("") + scale_color_viridis_d()

```
  
In contrast to experiment 1, in experiment 2 mice showed an increase in discrimination performance in the congruent condition only when compared to the volume baseline, but not when compared to the probability baseline (Fig. \@ref(fig:exp2)). As in experiment 1, the discrimination performance in the incongruent condition was lower than in either of the two baselines (Fig. \@ref(fig:exp2)). Although the discrimination performance in the incongruent condition was again different from 0.5 (`r paste(mean_inc2$ymin, mean_inc2$y, mean_inc2$ymax, sep = " < ")`), it was lower than chance, thus skewed towards probability (Fig. \@ref(fig:resoverview)).


## Experiment 3
In the previous experiments we used two different baseline conditions for each dimension (BPV1, BPV2, BVP1, and BVP2, Table \@ref(tab:conds)), in order to exhaust all combinations of reward stimuli and balance the experimental design. But could it be that the level of the background dimension despite being the same across choice options nevertheless affected the discrimination performance on the relevant dimension? Researches have proposed that in multi-dimensional choice the decision process can be considerably simplified if differences that are (nearly) equal are not evaluated but ignored [@tversky_intransitivity_1969; @shafir_intransitivity_1994; @shafir_comparative_2014]. Thus we can predict that regardless of the level of the background dimension, the discrimination performance on the relevant dimension should remain constant. Alternatively, animals could use all information from every reward dimensions for the estimation of a single value (utility) [@tversky_intransitivity_1969; @shafir_intransitivity_1994; @shafir_comparative_2014]. Since the utility curve is generally assumed to progressively increase with the increase in any given good, but with a decreasing slope [@kahneman_prospect_1979; @kenrick_deep_2009; but see also @kacelnik_risky_1998], we may expect that as the background dimension increases the subjective difference between the options will decrease and the discrimination performance will also decrease as a result. The same prediction can be made if we assume that the strength of preference is increased under lean environmental conditions, i.e. at low reward volume or probability [@schuck-paim_state-dependent_2004]. In order to test whether the two reward dimensions (volume and probability) interact with each other even when one of them is irrelevant (being the same across choice options), we performed experiment 3.  
  
(ref:labresexp3) **Slope estimates for the effect of the background dimension on the discrimination performance in the relevant dimension**. The two choice options always differed along the relevant dimension (either probability or volume, given on the abscissa) at a fixed relative intensity. The discrimination performance for each mouse was measured at four different levels of the background dimension, which was set at the same values on both choice options during a single drinking session, but differed from condition to condition (Table \@ref(tab:conds)). Each symbol is the average for an individual mouse over the two presentations of the same condition (original and reversal). The smallest effect size of interest was determined to be the slope that would have resulted in a difference in discrimination performance of 0.1, from the lowest to the highest level of the background dimension. The remaining notation is the same as in Fig. \@ref(fig:exp1).   
  
```{r exp3, fig.cap="(ref:labresexp3)"}

slopes <- exp3 %>%
  split(.$dim) %>%
  map(~ lmer(performance ~ bg_level + (bg_level|IdLabel), data = .)) %>%
  map(coef) %>%
  map("IdLabel") %>%
  map_df(~rownames_to_column(., var = "IdLabel"))

dims <- data.frame(dimension = rep(c("prob", "vol"), each = 24))

cohorts <- exp3 %>%
  ungroup() %>%
  select(IdLabel, cohort) %>%
  distinct()

slopes <- slopes %>%
  bind_cols(dims) %>%
  rename(slope = bg_level) %>%
  inner_join(cohorts)

set.seed(42)
CIs <- slopes %>%
  nest(-dimension) %>%
  mutate(test = map(data, ~ mean_cl_boot(.x$slope, conf.int = 1 - 2*(alpha_1)))) %>%
  unnest(test) %>%
  select(-data)

prob_slope <- CIs %>%
  filter(dimension == "prob") %>%
  pull(ymin) %>%
  round(3)

mean_PV1 <- exp3 %>%
  filter(cond == "PV1") %>%
  summarise(performance = mean(performance)) %>%
  pull(performance)

pred_PV4 <- slopes %>%
  filter(dimension == "prob") %>%
  summarise(intercept = mean(`(Intercept)`)) + prob_slope

sl_sesoi <- data.frame(val = c(4/20, 20/20),
                       performance = c(0.5, 0.6))

sl_sesoi <- coef(lm(performance ~ val, data = sl_sesoi))[2]

ggplot() +
  geom_pointrange(data = CIs, aes(x = dimension, y = y, ymin = ymin, ymax = ymax),
                  color = "darkblue", size = 1) +
  geom_hline(yintercept = sl_sesoi, linetype = 2) +
  geom_hline(yintercept = -sl_sesoi, linetype = 2) +
  theme_bw() +
  geom_jitter(data = slopes,
              aes(dimension, slope, color = cohort), alpha = 0.7, width = 0.1) +
  ylab("difference") +
  scale_color_viridis_d()

```
  
The conditions in experiment 3 were chosen to be similar to the background conditions in the previous experiments, by having one background and one relevant dimension (Table \@ref(tab:conds)). The relevant dimension always differed between the two options. For the probability dimension, we selected the same values of 0.2 and 0.5 (rel.int. = 0.86), as in the previous experiments. For the volume dimension we selected the values of 4 $\mu$L (4.8 $\mu$L in cohort 2) and 10 $\mu$L (9.6 $\mu$L in cohort 2), because the combination of a higher volume with a probability of 0.8 was expected to result in an insufficient number of visits for analysis (Table \@ref(tab:conds)). Cohort 2 had different reward volumes due to differences in the pumping process (Animals, Materials, and Methods), which also resulted in a lower relative intensity for volume (0.67 instead of 0.86). There were four different levels for each background dimension (volume and probability, Table \@ref(tab:conds)). Each mouse had its own pseudo-random sequence of the eight possible conditions. As in all other experiments, each condition was followed by a reversal. In order to test whether the background dimension affected discrimination performance, we fitted linear mixed models for each dimension, with discrimination performance as the dependent variable, background level as the independent variable and mouse as a random variable, using lme4 in R [@bates_fitting_2015]. The background level was the proportion of the actual value to the maximum of the four values tested, e.g. the background levels for volumes `r bg_vol` were `r bg_lev_vol`, respectively. We defined *a priori* a smallest effect size of interest (sesoi), as `r sl_sesoi`, which is the slope that would result from a difference of 0.1 in discrimination performance between the smallest and the largest background levels (PV1 and PV4, 0.2 and 1, respectively). A slope (whether positive or negative) within the sesoi interval was considered equivalent to zero and demonstrating a lack of an effect of background dimension.  
  
The results of experiment 3 show that the discrimination performance was independent from the level of the background dimension, since the slope was equivalent to zero for both probability and volume (Fig. \@ref(fig:resoverview), Fig. \@ref(fig:exp3)). These results support the hypothesis that decision-makers may ignore reward dimensions if options do not vary along them.

## Experiment 4  
In previous experiments [@rivalan_principles_2017], mice showed an improved discrimination performance for volume over time. A potential explanation is that, with experience mice become more attuned to the relevant dimension [More references and explanation on selective attention in multi-dimensional choice here...]

In order to test whether the discrimination performance for one or both dimensions improves over time, we performed experiment 4, which had the same conditions as experiment 1, but with a new pseudo-random order. The same mice participated in all experiments (1-4), with about seven weeks between experiment 1 and experiment 4. We tested the discrimination performance of all mice in each experimental condition for equivalence (Table \@ref(tab:conds)). As in the previous experiments, we also used equivalence tests on the contrasts between the baselines and the congruent and incongruent conditions.  

(ref:labexp4a) **Difference in discrimination performance between identical conditions in experiment 1 and experiment 4**. Same notation as in in Fig. \@ref(fig:exp1). The sequence of conditions was pseudo-random in each experiment and different for each individual. Positive differences indicate an increase in discrimination performance with time. Mice were seven weeks old at the beginning of experiment 1 and 13-14 weeks old at the beginning of experiment 4. The discrimination performance in the incongruent condition was calculated as the relative preference for the higher volume dispenser.    
  
```{r exp4a, fig.cap="(ref:labexp4a)"}
alpha_14 <- 0.05/5 # alpha corrected for multiple comparisons (n - 1) conditions

exp14 <- summaries %>%
  filter(!str_detect(cond, "[r]"), experiment == 1 | experiment == 4) %>%
  mutate(rep = ifelse(experiment == 1, 1, 2)) %>%
  ungroup() %>%
  mutate(rep = factor(rep))

exp14_simpl <- exp14 %>%
  ungroup() %>%
  # mutate(cond = as.factor(ifelse(str_length(cond) == 4, str_sub(cond, 1, 2),
  #                                as.character(cond)))) %>%
  group_by(cond, IdLabel, cohort, rep) %>%
  summarise(performance = mean(performance))

exp14_diff <- exp14_simpl %>%
  spread(rep, performance) %>%
  mutate(difference = `2` - `1`)

set.seed(42)
CIs_14 <- exp14_diff %>%
  ungroup() %>%
  nest(-cond) %>%
  mutate(test = map(data, ~ mean_cl_boot(.x$difference, conf.int = 1 - 2*(alpha_14)))) %>%
  unnest(test) %>%
  select(-data)

exp14_diff %>%
  ggplot() +
  geom_hline(yintercept = 0.1, linetype = 2) + geom_hline(yintercept = -0.1, linetype = 2) +
  geom_pointrange(data = CIs_14, aes(x = cond, y = y, ymin = ymin, ymax = ymax),
                  color = "darkblue", size = 1) +
  theme_bw() + geom_jitter(aes(cond, difference, color = cohort), alpha = 0.7, width = 0.1) +
  ylab("difference (after - before)") +
  scale_color_viridis_d()

```
  
In the comparison between experiment 1 and experiment 4, mice showed an improved discrimination performance in both volume baselines and in the incongruent condition (Fig. \@ref(fig:exp4a)). There was no change in the BVP2 and C conditions, and the results for BPV1 were inconclusive (confidence interval crosses zero line and not completely bounded by sesoi). Thus, consistent with our prior findings, mice improved their volume discrimination over time. The discrimination performance in the congruent condition was better than in the probability baseline, but the same as in the volume baseline (Fig. \@ref(fig:exp4b)). The discrimination in the incongruent condition was lower than in any of the two baselines, but the difference to the volume baseline was smaller (Fig. \@ref(fig:exp4b)). Thus, as in our previous experiments, mice showed an improvement in volume discrimination over time. Furthermore, compared to experiment 1 the influence of the volume dimension on choice was even more pronounced.  

(ref:labexp4b) **Difference between discrimination performance in the baseline conditions and in the congruent and incongruent conditions in experiment 4**. Same notation as in Fig. \@ref(fig:exp1). The discrimination performance in the incongruent condition was calculated as the relative preference for the higher probability dispenser when comparing to the probability baseline and for the higher volume dispenser when comparing to the volume baseline. Compare to Fig. \@ref(fig:exp1). 

```{r exp4b, fig.cap="(ref:labexp4b)"}
exp4_simpl <- exp14_simpl %>%
  filter(rep == 2) %>%
  ungroup() %>%
  mutate(cond = as.factor(ifelse(str_length(cond) == 4, str_sub(cond, 1, 2),
                                 as.character(cond)))) %>%
  group_by(cond, IdLabel, cohort) %>%
  summarise(performance = mean(performance))

exp4_diff <- exp4_simpl %>%
  spread(cond, performance) %>%
  mutate("BP - BV" = BP - BV, "C - BP" = C - BP, "C - BV" = C - BV,
         "I - BP" = 1 - I - BP, "I - BV" = I - BV) %>%
  select(-BV, -BP, -C, -I) %>%
  gather(cond, difference, -cohort, -IdLabel)

set.seed(42)
exp4_diff %>%
  filter(cond != "BP - BV") %>%
  ggplot(aes(cond, difference)) +
  geom_hline(yintercept = sesoi, linetype = 2) + geom_hline(yintercept = -sesoi, linetype = 2) +
  stat_summary(aes(cond, difference), fun.data = mean_cl_boot,
               fun.args = list(conf.int = 1 - 2*(alpha_2)),
               color = "darkblue", size = 1) +
  theme_bw() + geom_jitter(aes(color = cohort), alpha = 0.7, width = 0.1) +
  xlab("") + scale_color_viridis_d()
```


## Decision models of two-dimensional choice

We based our decision models on the Scalar Utility Theory (SUT, @kacelnik_risky_1998; @rosenstrom_scalar_2016), which models memory traces for reward amounts as normal distributions centered around the remembered value (e.g. volume). The scalar property is implemented by setting the standard deviations of these distributions to be proportional to their means. Choice can then be modeled by taking a single sample from each distribution and selecting the option with the larger sample. We extended this action selection procedure by an additional feature. In order to ensure exploration even when the overlap between distributions approached zero, we used an $\epsilon$-greedy strategy, so that with probability $\epsilon$ an agent chose at random and at probability 1 - $\epsilon$ the agent used the SUT action selection. In the following we refer to $\epsilon$ as the lapse rate [@rivalan_principles_2017]. [perhaps it is better to let $\epsilon = 0$ and only have the coefficient of variation as a free parameter?]  
As previously explained, the discrimination performance of reward probability can be reasonably predicted by the relative intensity of the two options [@rivalan_principles_2017]. This suggests that the memory traces of reward probabilities or of overall utility also exhibit the scalar property, so that discrimination of small probabilities (e.g. 0.2 vs. 0.5, rel.int. = 0.86) is easier  than discrimination of large probabilities (e.g. 0.5 vs. 0.8, rel.int. = 0.46). Consequently, discrimination (of either volumes or probabilities) when options vary along a single dimension can be modeled by SUT.  

We next extend this model for multi-dimensional choice situations. We considered various implementations of the base SUT model described above that differed in the integration of information from the volume and probability dimensions. These models were:  

1. *Scalar expected value model*. There is a single memory trace for each option and it consists in the simple product of the estimate for the volume and the estimate for the probability (expected value). The scalar property is implemented as $N(vp,\gamma\cdot vp)$, where $v$ is the volume estimate, $p$ is the probability estimate, and $\gamma$ is a free parameter, the coefficient of variation. This model thus utilizes information from all dimensions for every decision.    

2. *Hurdle model*. There are traces for each dimension for every option, where each trace exhibits the scalar property independently and the value is obtained by simple multiplication of the traces for each dimension: $N(v, \gamma \cdot v)\times N(p, \gamma \cdot p)$. This model also utilizes information from all dimensions for every decision. Although this model allows each dimension to have its own scalar factor, e.g. $\gamma_{p} \neq \gamma_{v}$, for the sake of simplicity we assume that they are both equal.   

The memory traces in the remaining models are identical to the traces in model 2, but these models usually consider only a single dimension.  
  
3. *Random dimension model*. Each decision is based on a single dimension, selected with probability 0.5.  

4. *Winner-takes-all model*. Each decision is based only on the dimension with the higher subjective salience. The salience for a vector of samples $(S_i)$ from the underlying memory traces along one dimension, e.g. volume $v = (S_{1}, S_{2}, ..., S_{n})$, is calculated as $n\cdot\frac{max(v) - min(v)}{\sum_{i=1}^{n}{v}}$, where $n$ is the number of options. In the case of $n = 2$, the salience is equivalent to the previously described relative intensity measure. For dimensions of equal salience the model reverts to model 3.  
  
The last two models are examples of a lexicographic rule, in which the dimensions are checked in a specific order. If the salience of a dimension is higher than a given threshold, then a decision is made based only on this dimension. Otherwise the next-order dimension is checked. If all dimensions have saliences below the threshold, the model reverts to model 3.  The value of the threshold was 0.8, the psychometric function threshold for probability [@rivalan_principles_2017].  

5. *Probability first model*. Probability is checked first, then volume.   

6. *Volume first model*. Volume is checked first, then probability.  
  
```{r message = FALSE, warning = FALSE}

#### cv baseline fit for prob and later out of sample test approach 
cv_fit <- function(phys1, phys2, cv, lapse) {
  (1 - lapse) * pnorm(0, mean = phys1 - phys2, sd = cv * sqrt(phys1^2 + phys2^2), lower.tail = FALSE) + lapse * 0.5
}


se <- function(x) sqrt(var(x)/length(x)) # function for calculating the standard error

baselines <- summaries %>%
  filter(str_detect(cond, "BP")) %>%
  mutate(phys1 = ifelse(experiment == 2, 1, 0.5),
         phys2 = 0.2) %>%
  group_by(IdLabel) %>%
  mutate(lapse = mean(sampling) * 2)

cvs <-  baselines %>%
  nest(-IdLabel) %>%
  mutate(test = map(data, ~ coef(nls(performance ~ cv_fit(phys1, phys2, cv, lapse = lapse), 
                                weights = Nrel,
                                start = c(cv = 0.5),
                                lower = c(cv = 0),
                                upper = c(cv = 5),
                                data = .x,
                                algorithm = "port",
                                control = list(maxiter = 5000))))) %>%
  unnest(test) %>%
  unnest(data) %>%
  group_by(IdLabel, cohort, lapse) %>%
  summarise(cv = mean(test))

mean_cvs <- cvs %>%
  ungroup() %>%
  summarise_at(vars(cv, lapse), funs(mean, se)) %>%
  mutate_if(is.numeric, round, 2)

baselines_vol <- summaries %>%
  filter(str_detect(cond, "BV")) %>%
  mutate(phys1 = 20,
         phys2 = 4) %>%
  group_by(IdLabel) %>%
  mutate(lapse = mean(sampling) * 2)

cvs_vol <-  baselines_vol %>%
  nest(-IdLabel) %>%
  mutate(test = map(data, ~ coef(nls(performance ~ cv_fit(phys1, phys2, cv, lapse = lapse), 
                                weights = Nrel,
                                start = c(cv = 0.5),
                                lower = c(cv = 0),
                                upper = c(cv = 5),
                                data = .x,
                                algorithm = "port",
                                control = list(maxiter = 5000))))) %>%
  unnest(test) %>%
  unnest(data) %>%
  group_by(IdLabel, cohort, lapse) %>%
  summarise(cv = mean(test))
 
mean_cvs_vol <- cvs_vol %>%
  # ungroup() %>%
  group_by(cohort != 2) %>%
  summarise_at(vars(cv, lapse), funs(mean, se))


sims_data <- read.csv2(file = "data/simulations.csv",
                        header = TRUE, dec = ".", sep = ";", na.strings = "NA")

summ_sims <- sims_data %>%
  group_by(experiment, cond, model) %>%
  summarise(m_perf = median(performance))

summ_sims <- summ_sims %>%
  filter(experiment == 1) %>%
  ungroup() %>%
  mutate(experiment = 4) %>%
  bind_rows(summ_sims) %>%
  arrange(experiment, cond, model)

emp_perf <- summaries %>%
  filter(!str_detect(cond, "[r]")) %>%
  select(IdLabel, cohort, experiment, cond, performance)

emp_perf <- emp_perf %>%
  filter(cond == "BVP1") %>%
  mutate(experiment = 2) %>%
  bind_rows(emp_perf) %>%
  arrange(IdLabel, cohort, cond)

devs <- summ_sims %>%
  full_join(emp_perf) %>%
  mutate(deviance = (m_perf - performance)^2,
         dev = abs(m_perf - performance))


RMSEs <- devs %>%
  filter(!str_detect(cond, "BP")) %>%
  group_by(experiment, model) %>%
  summarise(RMSE = sqrt(mean(deviance, na.rm = TRUE))) %>%
  arrange(experiment, RMSE)

rmse_ranks <- function(tibb) {
  tibb %>%
    mutate(rank = rank(RMSE)) %>%
    ungroup() %>%
    select(-RMSE) %>%
    spread(experiment, model)
}

ranks <- RMSEs %>%
  rmse_ranks()

RMSEs_cohorts <- devs %>%
  filter(!str_detect(cond, "BP")) %>%
  mutate(cage1 = cohort != 2) %>%
  group_by(experiment, model, cage1) %>%
  summarise(RMSE = sqrt(mean(deviance, na.rm = TRUE))) %>%
  arrange(cage1, experiment, RMSE)

ranks_coh2 <- RMSEs_cohorts %>%
  filter(!cage1) %>%
  select(-cage1) %>%
  group_by(experiment) %>%
  rmse_ranks()

ranks_coh13 <- RMSEs_cohorts %>%
  filter(cage1) %>%
  select(-cage1) %>%
  group_by(experiment) %>%
  rmse_ranks()
```

All models described above share the same two free parameters: the scalar factor $\gamma$ (coefficient of variation) and the lapse rate. In order to obtain an estimate for $\gamma$, we first fitted a single-dimension SUT model to the probability baseline discrimination performances of all mice in experiments 1, 2, and 4 (conditions BPV1 and BPV2). The lapse rate was estimated as twice the frequency of sampling, i.e. twice the frequency of visits to the non-rewarding dispensers over the baseline conditions [@rivalan_principles_2017]. The resulting average estimates (across animals) for $\gamma$ (`r mean_cvs$cv_mean`) and the lapse rate (`r mean_cvs$lapse_mean`) were then used as the values of the free parameters in out-of-sample tests of the six models. With each model  we generated 100 choices by 100 individuals for each experimental condition. We then quantified the model fits to the empirical data by calculating root-mean-square-errors (RMSE), excluding the BPV1 and BPV2 conditions in experiments 1, 2, and 4. Finally, we ranked the models by the RMSE scores. Since we wanted to analyze asymptotic choice, we did not model learning but assumed that the memory traces of the agents were accurate estimates of the physical reward properties.  
  
```{r modTable}
data.frame(model = 1:6,
           description = c("scalar expected value", "hurdle", "random dimension",
                           "winner takes it all", "probability first",
                           "volume first")) %>%
  knitr::kable(booktabs = TRUE, caption = "Decision-making models") %>%
  kableExtra::kable_styling(latex_options = c("striped", "hold_position"),
                full_width = F)
```

```{r simRankTable}
ranks %>%
  knitr::kable(booktabs = TRUE,
               caption = "Best performing models ranked by root-mean-square-errors (RMSE).") %>%
  kableExtra::kable_styling(latex_options = c("striped", "hold_position"),
                full_width = T) %>%
  kableExtra::add_header_above(c(" " = 1, "experiment" = 4))
```

There was no single model that could best explain the choice of the mice in all experiments, but only models 1 (scalar expected value), 2 (hurdle) and 4 (winner-takes-all), were in the top-three performing models for three out of the four experiments (Tables \@ref(tab:modTable), \@ref(tab:simRankTable), see also Appendix 1 Figures \@ref(fig:simexp1), \@ref(fig:simexp2), \@ref(fig:simexp3), and \@ref(fig:simexp4)). However, due to the striking differences in performance between cohort 2 and the other cohorts, we also ranked the models separately for the different mouse groups, depending on which cage they performed the experiments in (cohorts 1 and 3 in cage 1 and cohort 2 in cage 2). Indeed, two different patterns emerged for the different cages. For the two cohorts in cage 1, models 1 (scalar expected value) and 2 (hurdle) were best supported, followed by models 4 (winner-takes-all) and 6 (volume first). Notably, model 6 (volume first) was the best performing model in experiment 4. In contrast, model 5 (probability first) was the best supported model for cohort 2, followed by models 3 (random dimension) and 4 (winner-takes-all).

```{r coh13RankTable}
ranks_coh13 %>%
  knitr::kable(booktabs = TRUE,
               caption = "Best performing models ranked by root-mean-square-errors (RMSE) for cohorts 1 and 3.") %>%
  kableExtra::kable_styling(latex_options = c("striped", "hold_position"),
                full_width = T) %>%
  kableExtra::add_header_above(c(" " = 1, "experiment" = 4))
```


```{r coh2RankTable}
ranks_coh2 %>%
  knitr::kable(booktabs = TRUE,
               caption = "Best performing models ranked by root-mean-square-errors (RMSE) for cohort 2.") %>%
  kableExtra::kable_styling(latex_options = c("striped", "hold_position"),
                full_width = T) %>%
  kableExtra::add_header_above(c(" " = 1, "experiment" = 4))
```
# Discussion

Use of complete information vs. heuristics.  
Emergence of take-the-best heuristic? What level is the scalar property properly applied to? It is not possible to differentiate from our data, whether probabilities are actually estimated without any noise, but the noise is "added" during integration with volume (as postulated in the SUT), or both volume and probability independently exhibit the scalar property and their product (expected value) does as well.  
The volumes delivered to the mice were not error-free, but the pumping process (and most? aliquoting processes) inherently makes the error proportional to the volume dispensed. However, this delivery error is measurably much smaller than the fitted values for $\gamma$.   

## Difference between cohorts

We do not have an explanation for the striking difference in discrimination performance between cohort 2 and the rest. One possibility is that it is an unexpected side-effect of the difference in reward delivery mechanisms between cages. As explained in the Methods, the precision of the reward reward volumes was lower in cage 2, which housed cohort 2. However, the magnitude of the difference is small ($0.33 \pm 0.03  \mu Lstep^{-1}$ vs. $1.56 \pm 0.24  \mu Lstep^{-1}$), which is not expected to influence volume discrimination to the observed extent. Future experiments can address this by specifically manipulating the reliability of the volume dimension.  

## Is $\gamma$ constant?  
Most likely not, at least for volume: the discrimination performance improves over time, approaching the performance for probability. This can be seen as evidence against model 1 and support for two different $\gamma$ in model 2. Alternatively, the gamma is the same, but the weighting between the two dimension changes over time (model 3, but with unequal weights).    

# Animals, Methods, and Materials

The different experimental conditions for all animals and cohorts are listed in Table \@ref(tab:conds).

Guidelines can be included for standard research article sections, such as this one. 

Any "personal communications" relating to unpublished data should be incorporated within the main text, in the following format: (Author Initial(s) and Surname, personal communication, Month and Year). Authors should have permission from anyone named in this way and should be aware that a supporting letter will sometimes be requested.
Within the Materials and Methods and/or figure legends, we encourage authors to provide complete information about their experiments, analyses, or data collection to ensure that readers can easily understand what was measured and analysed, and can accurately perform the relevant protocols.
In cases where a new method within the submission would benefit from step-by-step protocols in addition to the methods described in the article, we would encourage authors to also consider submitting a detailed protocol to Bio-protocol.
On first mention, please provide details of any manufacturers in the following format: company name, city, country (or state, if based in the United States).


\newpage
# Appendix {-}

\beginsupplement


(ref:labsimexp1) **Comparison of discrimination performances in all six simulation models and in the three mouse cohorts in Experiment 1**. Columns give the condition names (Table \@ref(tab:conds)) and rows, the model number (Table \@ref(tab:modTable)).  Empirical data from the three cohorts are represented by differently color-filled density curves from the observed discrimination performances. Simulation data are represented by an empty thick-lined density curve. The dashed line gives the median of the empirical data and the dotted line - the median of the simulated data. The discrimination performance gives the relative visitation rate of the more profitable option, or, in the incongruent condition, the option with the higher volume.  

```{r simexp1, fig.height = 7, fig.width = 10, fig.cap="(ref:labsimexp1)"}
exp1 <- exp1 %>%
  group_by(cond) %>%
  mutate(m_perf = median(performance))


ggplot() +
  geom_density(aes(performance), size = 1.2, data = sims_data %>% filter(experiment == 1)) +
  facet_grid(model ~ cond) +
  geom_density(aes(performance, fill = cohort), alpha = 0.2, data = exp1) +
  theme_bw() + scale_fill_viridis_d() +
  scale_x_continuous(name = "discrimination performance", breaks = c(0, 0.5, 1)) +
  geom_vline(aes(xintercept = m_perf), linetype = 2, data = exp1) +
  # geom_vline(xintercept = cv_fit(0.5, 0.2, cv = 0.7, lapse = 0.1), linetype = 1) +
  geom_vline(aes(xintercept = m_perf), linetype = 3, size = 1.2, data = summ_sims %>%
               filter(experiment == 1)) +
  labs(fill = "cohort") + guides(color = FALSE) + theme(strip.text.y = element_text(angle = 0))

```

(ref:labsimexp2) **Comparison of discrimination performances in all six simulation models and in the three mouse cohorts in Experiment 2**. Same notation as in Fig. \@ref(fig:simexp1).

```{r simexp2,  fig.height = 7, fig.width = 10, fig.cap="(ref:labsimexp2)"}
exp2 <- exp2 %>%
  group_by(cond) %>%
  mutate(m_perf = median(performance))

ggplot() +
  geom_density(aes(performance), size = 1.2, data = sims_data %>% filter(experiment == 2)) +
  facet_grid(model ~ cond) +
  geom_density(aes(performance, fill = cohort), alpha = 0.2, data = exp2) +
  theme_bw() + scale_fill_viridis_d() +
  scale_x_continuous(name = "discrimination performance", breaks = c(0, 0.5, 1)) +
  geom_vline(aes(xintercept = m_perf), linetype = 2, data = exp2) +
  geom_vline(aes(xintercept = m_perf), linetype = 3, size = 1.2, data = summ_sims %>%
               filter(experiment == 2)) +
  labs(fill = "cohort") + guides(color = FALSE) + theme(strip.text.y = element_text(angle = 0))

```

(ref:labsimexp3) **Comparison of discrimination performances in all six simulation models and in the three mouse cohorts in Experiment 3**. Same notation as in Fig. \@ref(fig:simexp1). 

```{r simexp3,  fig.height = 7, fig.width = 10, fig.cap="(ref:labsimexp3)"}
exp3 <- exp3 %>%
  group_by(cond) %>%
  mutate(m_perf = median(performance))

ggplot() +
  geom_density(aes(performance), size = 1.2, data = sims_data %>% filter(experiment == 3)) +
  facet_grid(model ~ cond) +
  geom_density(aes(performance, fill = cohort), alpha = 0.2, data = exp3) +
  theme_bw() + scale_fill_viridis_d() +
  scale_x_continuous(name = "discrimination performance", breaks = c(0, 0.5, 1)) +
  geom_vline(aes(xintercept = m_perf), linetype = 2, data = exp3) +
  geom_vline(aes(xintercept = m_perf), linetype = 3, size = 1.2, data = summ_sims %>%
               filter(experiment == 3)) +
  labs(fill = "cohort") + guides(color = FALSE) + theme(strip.text.y = element_text(angle = 0))

```

(ref:labsimexp4) **Comparison of discrimination performances in all six simulation models and in the three mouse cohorts in Experiment 4**. Same notation as in Fig. \@ref(fig:simexp1). 

```{r simexp4,  fig.height = 7, fig.width = 10, fig.cap="(ref:labsimexp4)"}
exp4 <- exp4 %>%
  group_by(cond) %>%
  mutate(m_perf = median(performance))

ggplot() +
  geom_density(aes(performance), size = 1.2, data = sims_data %>% filter(experiment == 1)) +
  facet_grid(model ~ cond) +
  geom_density(aes(performance, fill = cohort), alpha = 0.2, data = exp4) +
  theme_bw() + scale_fill_viridis_d() +
  scale_x_continuous(name = "discrimination performance", breaks = c(0, 0.5, 1)) +
  geom_vline(aes(xintercept = m_perf), linetype = 2, data = exp4) +
  geom_vline(aes(xintercept = m_perf), linetype = 3, size = 1.2, data = summ_sims %>%
               filter(experiment == 1)) +
  labs(fill = "cohort") + guides(color = FALSE) + theme(strip.text.y = element_text(angle = 0))

```

# Acknowledgments
Individuals who have contributed materially to the work, but do not satisfy the authorship criteria should be listed in the acknowledgements section. Authors should seek permission to include any individuals mentioned in the acknowledgements.  

# Competing interests
At this stage we request that the corresponding author provides a statement of financial and non-financial competing interests on behalf of all authors. Examples include paid employment or consultancy, stock ownership, patent applications, personal relationships with relevant individuals, and membership of an advisory board.



# References
